<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Felipe Forero</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<style>
:root{
--bg:#0b0f14;
--panel:#101826;
--text:#e7eef9;
--muted:#94a3b8;
--good:#22c55e;
--bad:#ef4444;
--btn:#172334;
--radius:18px;
}
*{box-sizing:border-box}
body{
margin:0;
font-family:system-ui;
background:var(--bg);
color:var(--text);
}
header{
position:sticky;
top:0;
background:#0f1620;
padding:18px;
border-bottom:1px solid #1f2a3a;
z-index:10;
}
.toprow{
display:flex;
justify-content:space-between;
flex-wrap:wrap;
gap:10px;
align-items:center;
}
.badge{
font-size:12px;
color:var(--muted);
}
select,button{
background:var(--btn);
color:var(--text);
border:1px solid #1f2a3a;
border-radius:10px;
padding:8px 12px;
cursor:pointer;
}
button:hover{opacity:.9}
.wrap{max-width:1100px;margin:auto;padding:20px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}
.card{
background:var(--panel);
padding:16px;
border-radius:var(--radius);
border:1px solid #1f2a3a;
}
.card h2{
font-size:13px;
text-transform:uppercase;
color:var(--muted);
margin:0 0 10px;
}
.task{
border:1px solid #1f2a3a;
padding:12px;
border-radius:14px;
margin-bottom:12px;
}
.task.done{border-color:var(--good)}
.task.missed{border-color:var(--bad)}
.bigbtn{
padding:8px 12px;
border-radius:10px;
margin-right:8px;
margin-top:6px;
}
.good{border-color:var(--good)}
.bad{border-color:var(--bad)}
.kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.kpi{
background:#0f1620;
padding:12px;
border-radius:14px;
border:1px solid #1f2a3a;
}
.kpi .value{font-size:22px;font-weight:700}
.report{
white-space:pre-wrap;
font-size:13px;
margin-top:10px;
background:#0f1620;
padding:10px;
border-radius:14px;
display:none;
}
.modalback{
position:fixed;
inset:0;
background:rgba(0,0,0,.6);
display:none;
align-items:center;
justify-content:center;
}
.modal{
background:#101826;
padding:20px;
border-radius:20px;
width:90%;
max-width:600px;
}
textarea{
width:100%;
min-height:100px;
background:#0f1620;
color:white;
border:1px solid #1f2a3a;
border-radius:10px;
padding:10px;
}
</style>
</head>

<body>

<header>
<div class="toprow">
<h1>Felipe Forero <span class="badge">Music First • simple • medible</span></h1>
<div>
<select id="daySelect"></select>
<button id="goToday">Hoy</button>
<button id="weeklyReport">Informe semanal</button>
<button id="resetWeek">Reset</button>
</div>
</div>
</header>

<div class="wrap">
<div class="grid">

<div class="card">
<h2>Tareas</h2>
<div id="tasks"></div>
<div class="report" id="report"></div>
</div>

<div class="card">
<h2>Estadísticas</h2>
<div class="kpis">
<div class="kpi"><div>% Hoy</div><div class="value" id="kpiToday">0%</div></div>
<div class="kpi"><div>% Semana</div><div class="value" id="kpiWeek">0%</div></div>
<div class="kpi"><div>Racha Música</div><div class="value" id="kpiStreak">0</div></div>
</div>
<canvas id="chart" height="150"></canvas>
</div>

</div>
</div>

<div class="modalback" id="modalBack">
<div class="modal">
<h3 id="modalTitle"></h3>
<textarea id="notes"></textarea>
<br><br>
<button id="saveClose">Guardar</button>
</div>
</div>

<script>
const DAYS=["mon","tue","wed","thu","fri","sat","sun"];
const DAY_LABELS={mon:"Lunes",tue:"Martes",wed:"Miércoles",thu:"Jueves",fri:"Viernes",sat:"Sábado",sun:"Domingo"};

const WEEK_PLAN={
mon:["musica","italiano","edicion"],
tue:["musica","foto","gym"],
wed:["musica","tatuar","gym","italiano"],
thu:["musica","italiano","animacion"],
fri:["musica","skate"],
sat:["musica","gym","edicion"],
sun:["musica","skate","animacion"]
};

const GOAL_NAMES={
musica:"Música",
italiano:"Italiano",
edicion:"Edición",
foto:"Fotografía",
gym:"Gym",
tatuar:"Tatuaje",
skate:"Skate",
animacion:"Animación"
};

const WEIGHTS={musica:5};

let state={
week:getWeek(),
selectedDay:getToday(),
data:JSON.parse(localStorage.getItem("ff_dash")||"{}")
};

function save(){localStorage.setItem("ff_dash",JSON.stringify(state.data))}

function getWeek(){
const d=new Date();
const onejan=new Date(d.getFullYear(),0,1);
return d.getFullYear()+"-W"+Math.ceil((((d-onejan)/86400000)+onejan.getDay()+1)/7);
}

function getToday(){
return DAYS[new Date().getDay()===0?6:new Date().getDay()-1];
}

function getRec(day,goal){
if(!state.data[state.week]) state.data[state.week]={};
if(!state.data[state.week][day]) state.data[state.week][day]={};
if(!state.data[state.week][day][goal]) state.data[state.week][day][goal]={status:null,notes:""};
return state.data[state.week][day][goal];
}

function setStatus(day,goal,status){
getRec(day,goal).status=status;
save();
render();
}

function render(){
document.getElementById("tasks").innerHTML="";
const plan=WEEK_PLAN[state.selectedDay];

plan.forEach(goal=>{
const rec=getRec(state.selectedDay,goal);
const div=document.createElement("div");
div.className="task "+(rec.status==="yes"?"done":rec.status==="no"?"missed":"");
div.innerHTML="<b>"+GOAL_NAMES[goal]+"</b><br>";

if(goal==="musica"){
div.innerHTML+=`
<button class="bigbtn good" onclick="setStatus('${state.selectedDay}','${goal}','yes')">Mínima</button>
<button class="bigbtn good" onclick="setStatus('${state.selectedDay}','${goal}','yes')">Profunda</button>
<button class="bigbtn bad" onclick="setStatus('${state.selectedDay}','${goal}','no')">No</button>
`;
}else{
div.innerHTML+=`
<button class="bigbtn good" onclick="setStatus('${state.selectedDay}','${goal}','yes')">Cumplí</button>
<button class="bigbtn bad" onclick="setStatus('${state.selectedDay}','${goal}','no')">No</button>
`;
}

div.onclick=()=>openModal(goal);
document.getElementById("tasks").appendChild(div);
});

updateStats();
}

function updateStats(){
let todayDone=0,total=0;
DAYS.forEach(d=>{
(WEEK_PLAN[d]||[]).forEach(g=>{
total++;
if(getRec(d,g).status==="yes") todayDone++;
});
});
document.getElementById("kpiToday").textContent=Math.round((todayDone/total)*100)+"%";
document.getElementById("kpiWeek").textContent=Math.round((todayDone/total)*100)+"%";

let streak=0;
for(let d of DAYS){
if(getRec(d,"musica").status==="yes") streak++;
else break;
}
document.getElementById("kpiStreak").textContent=streak;

renderChart();
}

let chart;
function renderChart(){
const ctx=document.getElementById("chart");
if(chart) chart.destroy();
chart=new Chart(ctx,{type:"line",
data:{labels:DAYS.map(d=>DAY_LABELS[d].slice(0,3)),
datasets:[{data:DAYS.map(d=>{
let done=0;
(WEEK_PLAN[d]||[]).forEach(g=>{if(getRec(d,g).status==="yes") done++;});
return done;
})}]},
options:{plugins:{legend:{display:false}}}
});
}

function openModal(goal){
const rec=getRec(state.selectedDay,goal);
document.getElementById("modalTitle").textContent=GOAL_NAMES[goal];
document.getElementById("notes").value=rec.notes||"";
document.getElementById("modalBack").style.display="flex";
document.getElementById("saveClose").onclick=()=>{
rec.notes=document.getElementById("notes").value;
save();
document.getElementById("modalBack").style.display="none";
};
}

document.getElementById("daySelect").innerHTML=
DAYS.map(d=>"<option value='"+d+"'>"+DAY_LABELS[d]+"</option>").join("");

document.getElementById("daySelect").value=state.selectedDay;
document.getElementById("daySelect").onchange=e=>{state.selectedDay=e.target.value;render();};
document.getElementById("goToday").onclick=()=>{state.selectedDay=getToday();render();};
document.getElementById("resetWeek").onclick=()=>{delete state.data[state.week];save();render();};

document.getElementById("weeklyReport").onclick=()=>{
const rep=document.getElementById("report");
rep.style.display="block";
rep.textContent="Cumplimiento semanal: "+document.getElementById("kpiWeek").textContent;
};

render();
</script>
</body>
</html>
